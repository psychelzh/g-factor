---
title: Behavior Analysis
author: Liang Zhang
date: 2022-11-17
format: 
  revealjs:
    code-fold: false
execute: 
  warning: false
  message: false
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
targets::tar_load(indices_clean)
targets::tar_load(indices_wider)
targets::tar_load(indices_wider_clean)
targets::tar_load(mdl_data)
```

# Data Inspection

## Distributions

```{r}
#| label: fig-distr
#| fig-width: 8
#| fig-height: 6
#| fig-cap: >
#|   **Distributions for All Tasks.** They are all all fairly distributed as 
#|   normal.
indices_clean |> 
  ggplot(aes(score)) +
  geom_histogram() +
  facet_wrap(~ disp_name + index, scales = "free")
```

## Missing Pattern

```{r}
#| label: fig-miss-pattern
#| fig-width: 8
#| fig-height: 6
#| fig-cap: >
#|   **Misssing pattern.** Stop signal task has slightly more missing values.
#|   Subjects with missing values at more than 20% of tasks are removed in
#|   further analysis.
indices_wider |> 
  select(-sub_id) |> 
  naniar::vis_miss() +
  theme(axis.text.x = element_text(angle = 90))
```

# Model Building

## Correlation Matrix

```{r}
#| label: fig-correlation
#| fig-width: 8
#| fig-height: 8
#| fig-cap: "**Correlation Between Tasks**"
mdl_data |> 
  corrr::correlate() |> 
  corrr::autoplot()
```

## The promising models

:::: {.columns}

::: {.column}
```{r}
#| label: fig-common-fac
#| fig-width: 8
#| fig-height: 8
#| fig-cap: "**Common Factor Model**"
fit <- psych::fa(mdl_data, 5)
psych::fa.diagram(fit)
```
:::

::: {.column}
```{r}
#| label: fig-bifac
#| fig-width: 8
#| fig-height: 8
#| fig-cap: "**Bi-Factor Model**"
fit <- psych::omega(mdl_data, 5, plot = FALSE)
psych::omega.diagram(fit)
```
:::

:::

# General Factor Scores Estimation

We then proceed by sticking to one-factor model (exploratory factor analysis with one latent factor only). We want to find out the required number of variables for a stable g-factor scores estimation. So a number of simulations are done with different number of variables used to estimate g-factor scores. Those simulated g-factor scores are correlated with the g-factor scores from all-variable (21 variables in total) model.

## Correlation with scores of all-variable model {.smaller}

```{r}
#| label: fig-cor-dist
#| fig-width: 8
#| fig-height: 6
#| fig-cap: >
#|   **Correlation distribution of simulations with different number of selected
#|   variables.** Each point is the correlation between estimated general factor
#|   scores from selected variables and those from all variables. Simulation was
#|   done with 3 to 18 (step of 3) variables. Note there are a number of negative
#|   correlations for 3 to 9 variable simulation.
targets::tar_load(cor_sims)
cor_sims |> 
  ggplot(aes(num_vars, r)) +
  ggdist::stat_dots() +
  theme_bw() +
  scale_x_continuous(breaks = scales::breaks_width(3)) +
  labs(x = "Number of Variables", y = "Pearson's Correlation Coefficient")
```

## Absolute correlations

```{r}
#| label: fig-cor-trend
#| fig-width: 8
#| fig-height: 6
#| fig-cap: >
#|   **Trending of absolute correlations**

cor_sims |> 
  mutate(abs_r = abs(r)) |> 
  ggplot(aes(num_vars, abs_r)) +
  stat_summary(geom = "ribbon", fun.data = mean_sdl, fill = "lightblue") +
  stat_summary(geom = "point", fun = mean, fill = "white", color = "black") +
  stat_summary(geom = "line", fun = mean) +
  theme_bw() +
  scale_x_continuous(breaks = scales::breaks_width(3)) +
  labs(x = "Number of Variables", y = "Pearson's Correlation Coefficient")
```

